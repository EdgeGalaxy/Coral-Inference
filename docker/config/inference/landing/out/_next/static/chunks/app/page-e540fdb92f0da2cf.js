(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9423:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var s=r(5155),n=r(2115),a=r(2596),i=r(9688);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.QP)((0,a.$)(t))}let l=n.forwardRef((e,t)=>{let{className:r,asChild:n=!1,...a}=e;return(0,s.jsx)("button",{className:o("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50","bg-primary text-primary-foreground shadow hover:bg-primary/90","h-9 px-4 py-2",r),ref:t,...a})});l.displayName="Button";var c=r(6803),d=r(6474),u=r(5196),p=r(7863);function f(e){let{...t}=e;return(0,s.jsx)(c.bL,{"data-slot":"select",...t})}function g(e){let{...t}=e;return(0,s.jsx)(c.WT,{"data-slot":"select-value",...t})}function v(e){let{className:t,size:r="default",children:n,...a}=e;return(0,s.jsxs)(c.l9,{"data-slot":"select-trigger","data-size":r,className:o("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a,children:[n,(0,s.jsx)(c.In,{asChild:!0,children:(0,s.jsx)(d.A,{className:"size-4 opacity-50"})})]})}function m(e){let{className:t,children:r,position:n="popper",...a}=e;return(0,s.jsx)(c.ZL,{children:(0,s.jsxs)(c.UC,{"data-slot":"select-content",className:o("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...a,children:[(0,s.jsx)(h,{}),(0,s.jsx)(c.LM,{className:o("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:r}),(0,s.jsx)(b,{})]})})}function x(e){let{className:t,children:r,...n}=e;return(0,s.jsxs)(c.q7,{"data-slot":"select-item",className:o("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...n,children:[(0,s.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,s.jsx)(c.VF,{children:(0,s.jsx)(u.A,{className:"size-4"})})}),(0,s.jsx)(c.p4,{children:r})]})}function h(e){let{className:t,...r}=e;return(0,s.jsx)(c.PP,{"data-slot":"select-scroll-up-button",className:o("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(p.A,{className:"size-4"})})}function b(e){let{className:t,...r}=e;return(0,s.jsx)(c.wn,{"data-slot":"select-scroll-down-button",className:o("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(d.A,{className:"size-4"})})}var j=r(9708),y=r(2085);let w=(0,y.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function _(e){let{className:t,variant:r,asChild:n=!1,...a}=e,i=n?j.DX:"span";return(0,s.jsx)(i,{"data-slot":"badge",className:o(w({variant:r}),t),...a})}let N=(0,y.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function k(e){let{className:t,variant:r,...n}=e;return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:o(N({variant:r}),t),...n})}function z(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"alert-description",className:o("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...r})}var C=r(9509);let E={headers:{"Content-Type":"application/json",Accept:"application/json"}},P=()=>{{let e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e)return"http://localhost:9001"}return C.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:9001"};function S(){let[e,t]=(0,n.useState)([{id:"xxxxxx",status:"success"}]),[r,a]=(0,n.useState)(null),[i,o]=(0,n.useState)(!1),c=(0,n.useRef)(null),d=(0,n.useRef)(null),u=P(),p=async()=>{try{var e,s;let n=await fetch("".concat(u,"/inference_pipelines/list"),E),i=await n.json();console.log("data",i),t(null==(e=i.pipelines)?void 0:e.map(e=>({id:e}))),(null==(s=i.pipelines)?void 0:s.length)>0&&!r&&a(i.pipelines[0])}catch(e){console.error("Error fetching pipelines:",e)}},h=async e=>{try{let t=await fetch("".concat(u,"/inference_pipelines/").concat(e,"/status"),E);return(await t.json()).status}catch(e){return console.error("Error fetching pipeline status:",e),"unknown"}};(0,n.useEffect)(()=>{let r=setInterval(async()=>{t(await Promise.all(e.map(async e=>({...e,status:await h(e.id)}))))},5e3);return()=>clearInterval(r)},[e]),(0,n.useEffect)(()=>{p()},[]);let b=async()=>{if(r)try{d.current=new RTCPeerConnection,d.current.addTransceiver("video",{direction:"recvonly"}),d.current.ontrack=e=>{e.streams&&e.streams.length>0&&"video"===e.track.kind&&(console.log("Received remote stream:",e.streams[0]),c.current&&(c.current.srcObject=e.streams[0],console.log("Video srcObject set.")))},d.current.onconnectionstatechange=()=>{var e,t,r,s;console.log("Frontend Connection state:",null==(e=d.current)?void 0:e.connectionState),console.log("Frontend ICE Connection state:",null==(t=d.current)?void 0:t.iceConnectionState),((null==(r=d.current)?void 0:r.connectionState)==="failed"||(null==(s=d.current)?void 0:s.connectionState)==="disconnected")&&(console.error("WebRTC connection failed or disconnected"),o(!1),d.current&&(d.current.close(),d.current=null))};let e=await d.current.createOffer();await d.current.setLocalDescription(e),console.log("Frontend generated offer:",e);let t=await fetch("".concat(u,"/inference_pipelines/").concat(r,"/offer"),{...E,method:"POST",body:JSON.stringify({webrtc_offer:{type:e.type,sdp:e.sdp},stream_output:["output_image"],webcam_fps:30,max_consecutive_timeouts:10,min_consecutive_on_time:3,processing_timeout:1,fps_probe_frames:30})}),s=await t.json();if(!s||!s.sdp)throw Error("Invalid response from server: missing SDP");let n=s.sdp;if("string"!=typeof n)throw Error("Invalid SDP format: not a string");if(!n.includes("v=")||!n.includes("o=")||!n.includes("s="))throw console.error("Invalid SDP format:",n),Error("Invalid SDP format: missing required fields");try{let e=new RTCSessionDescription({type:"answer",sdp:n});await d.current.setRemoteDescription(e),console.log("Frontend set remote description (answer)."),o(!0)}catch(e){throw console.error("Error setting remote description:",e),Error("Failed to set remote description: "+e.message)}}catch(e){console.error("Error starting stream:",e),d.current&&(d.current.close(),d.current=null),o(!1)}},j=e=>{switch(e){case"running":return"bg-green-500";case"stopped":return"bg-red-500";default:return"bg-gray-500"}};return(0,s.jsxs)("main",{className:"min-h-screen p-8",children:[(0,s.jsx)("div",{className:"flex justify-start mb-8",children:(0,s.jsxs)(f,{value:r||"",onValueChange:e=>a(e),children:[(0,s.jsx)(v,{className:"w-[300px]",children:(0,s.jsx)(g,{placeholder:"选择 Pipeline"})}),(0,s.jsx)(m,{children:(null==e?void 0:e.length)===0?null:e.map(e=>(0,s.jsx)(x,{value:e.id,children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsx)("span",{className:"truncate",children:e.id}),(0,s.jsx)(_,{variant:"secondary",className:"ml-2 ".concat(j(e.status||"")),children:e.status})]})},e.id))})]})}),(0,s.jsx)("div",{className:"max-w-4xl mx-auto",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"aspect-video bg-black rounded-lg overflow-hidden mb-4",children:(0,s.jsx)("video",{ref:c,autoPlay:!0,playsInline:!0,className:"w-full h-full object-contain"})}),(0,s.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,s.jsx)(l,{onClick:b,disabled:!r||i,className:"bg-green-500 hover:bg-green-600",children:"开始"}),(0,s.jsx)(l,{onClick:()=>{d.current&&(d.current.close(),d.current=null),c.current&&(c.current.srcObject=null),o(!1)},disabled:!i,className:"bg-red-500 hover:bg-red-600",children:"停止"})]})]}):(0,s.jsx)(k,{children:(0,s.jsx)(z,{children:"请从左上角选择一个 Pipeline 开始"})})})]})}},9803:(e,t,r)=>{Promise.resolve().then(r.bind(r,9423))}},e=>{var t=t=>e(e.s=t);e.O(0,[953,441,684,358],()=>t(9803)),_N_E=e.O()}]);