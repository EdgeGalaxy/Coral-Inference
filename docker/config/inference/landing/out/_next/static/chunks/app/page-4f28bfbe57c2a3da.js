(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2801:(e,s,t)=>{Promise.resolve().then(t.bind(t,9143))},9143:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eT});var a=t(5155),r=t(2115),n=t(9708),l=t(2085),i=t(2596),c=t(9688);function d(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,c.QP)((0,i.$)(s))}t(9509);let o=e=>{switch(null==e?void 0:e.toLowerCase()){case"running":return"bg-green-500";case"pending":return"bg-blue-500";case"warning":case"paused":return"bg-yellow-500";case"failure":case"error":return"bg-red-600";case"muted":return"bg-gray-500";case"stopped":return"bg-red-500";case"not_found":return"bg-red-400";case"timeout":return"bg-orange-500";default:return"bg-gray-400"}},m=e=>{switch(null==e?void 0:e.toLowerCase()){case"running":return"text-green-600";case"pending":return"text-blue-600";case"warning":case"paused":return"text-yellow-600";case"failure":case"error":return"text-red-700";case"muted":default:return"text-gray-600";case"stopped":return"text-red-600";case"not_found":return"text-red-500";case"timeout":return"text-orange-600"}},x=e=>{switch(null==e?void 0:e.toLowerCase()){case"running":return"运行中";case"pending":return"等待中";case"warning":return"警告";case"failure":return"失败";case"muted":return"静音";case"stopped":return"已停止";case"not_found":return"未找到";case"timeout":return"超时";case"paused":return"暂停";case"error":return"错误";default:return"未知"}},u=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),h=r.forwardRef((e,s)=>{let{className:t,variant:r,size:l,asChild:i=!1,...c}=e,o=i?n.DX:"button";return(0,a.jsx)(o,{className:d(u({variant:r,size:l,className:t})),ref:s,...c})});h.displayName="Button";let f=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:d("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});f.displayName="Card";let p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:d("flex flex-col space-y-1.5 p-6",t),...r})});p.displayName="CardHeader";let j=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h3",{ref:s,className:d("text-2xl font-semibold leading-none tracking-tight",t),...r})});j.displayName="CardTitle";let g=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("p",{ref:s,className:d("text-sm text-muted-foreground",t),...r})});g.displayName="CardDescription";let N=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:d("p-6 pt-0",t),...r})});N.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:d("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter";var b=t(5713),w=t(6474),v=t(7863),y=t(5196);let A=b.bL;b.YJ;let k=b.WT,S=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(b.l9,{ref:s,className:d("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[r,(0,a.jsx)(b.In,{asChild:!0,children:(0,a.jsx)(w.A,{className:"h-4 w-4 opacity-50"})})]})});S.displayName=b.l9.displayName;let C=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(b.PP,{ref:s,className:d("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(v.A,{className:"h-4 w-4"})})});C.displayName=b.PP.displayName;let P=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(b.wn,{ref:s,className:d("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(w.A,{className:"h-4 w-4"})})});P.displayName=b.wn.displayName;let R=r.forwardRef((e,s)=>{let{className:t,children:r,position:n="popper",...l}=e;return(0,a.jsx)(b.ZL,{children:(0,a.jsxs)(b.UC,{ref:s,className:d("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...l,children:[(0,a.jsx)(C,{}),(0,a.jsx)(b.LM,{className:d("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(P,{})]})})});R.displayName=b.UC.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(b.JU,{ref:s,className:d("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=b.JU.displayName;let _=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(b.q7,{ref:s,className:d("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(b.VF,{children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})}),(0,a.jsx)(b.p4,{children:r})]})});_.displayName=b.q7.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(b.wv,{ref:s,className:d("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=b.wv.displayName;let I=(0,l.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-500/80",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-500/80",error:"border-transparent bg-red-500 text-white hover:bg-red-500/80"}},defaultVariants:{variant:"default"}});function E(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:d(I({variant:t}),s),...r})}t(9509);let T=()=>"".concat(window.location.protocol,"//").concat(window.location.hostname,":9001");class D extends Error{constructor(e,s,t){super(e),this.status=s,this.response=t,this.name="ApiError"}}async function z(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=T(),a="".concat(t).concat(e),r={headers:{"Content-Type":"application/json",...s.headers},...s};try{console.log("API请求: ".concat(s.method||"GET"," ").concat(a));let e=await fetch(a,r);if(!e.ok){let s=await e.text();throw new D("API请求失败: ".concat(e.status," ").concat(e.statusText).concat(s?" - ".concat(s):""),e.status,e)}let t=await e.json();return console.log("API响应:",t),t}catch(e){if(e instanceof D)throw e;throw console.error("API请求错误:",e),new D("网络错误: ".concat(e instanceof Error?e.message:"未知错误"),0)}}let U={async list(){try{return(await z("/inference_pipelines/list")).fixed_pipelines.map(e=>({id:e.pipeline_id,name:e.pipeline_name,status:"pending"}))}catch(e){throw console.error("获取Pipeline列表失败:",e),e}},async getInfo(e){try{return await z("/inference_pipelines/".concat(e,"/info"))}catch(e){throw console.error("获取Pipeline信息失败:",e),e}},async getMetrics(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{minutes:5};try{let t=new URLSearchParams;s.start&&t.append("start_time",s.start.toString()),s.end&&t.append("end_time",s.end.toString()),s.minutes&&t.append("minutes",s.minutes.toString());let a=t.toString(),r="/inference_pipelines/".concat(e,"/metrics").concat(a?"?".concat(a):"");return await z(r)}catch(e){throw console.error("获取Pipeline指标失败:",e),e}},async listWithStatus(){try{let e=(await this.list()).map(async e=>{try{let s=await L.getStatus(e.id),t=O.calculatePipelineStatus(s.status,s.report);return{...e,status:t}}catch(s){if(console.error("获取Pipeline ".concat(e.id," 状态失败:"),s),s instanceof D){if(404===s.status)return{...e,status:"not_found"};else if(0===s.status)return{...e,status:"timeout"}}return{...e,status:"failure"}}});return await Promise.all(e)}catch(e){throw console.error("获取Pipeline列表及状态失败:",e),e}},async createWebRTCOffer(e,s){try{let t=JSON.stringify(s);return console.log("发送的请求体:",t),await z("/inference_pipelines/".concat(e,"/offer"),{method:"POST",body:t})}catch(e){throw console.error("创建WebRTC连接失败:",e),e}}},L={async getStatus(e){try{return await z("/inference_pipelines/".concat(e,"/status"))}catch(e){throw console.error("获取Pipeline状态失败:",e),e}},async getDiskUsage(){try{return(await z("/monitor/disk-usage")).data}catch(e){throw console.error("获取磁盘使用情况失败:",e),e}},async flushCache(){try{return await z("/monitor/flush-cache",{method:"POST"})}catch(e){throw console.error("刷新缓存失败:",e),e}},async triggerCleanup(){try{return await z("/monitor/cleanup",{method:"POST"})}catch(e){throw console.error("触发清理失败:",e),e}},async getMonitorStatus(){try{return(await z("/monitor/status")).data}catch(e){throw console.error("获取监控器状态失败:",e),e}}},W={async list(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"records",t=new URLSearchParams;s&&t.append("output_directory",s);let a="/inference_pipelines/".concat(e,"/videos").concat(t.toString()?"?".concat(t.toString()):""),r=await z(a);if("success"!==r.status)throw new D(r.error||"获取录像列表失败");return r.files||[]},videoUrl(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"records",a=T(),r=new URLSearchParams;t&&r.append("output_directory",t);let n=r.toString();return"".concat(a,"/inference_pipelines/").concat(encodeURIComponent(e),"/videos/").concat(encodeURIComponent(s)).concat(n?"?".concat(n):"")}},O={calculatePipelineStatus(e,s){if("failure"===e)return"failure";if("not_found"===e)return"not_found";if("success"===e){if(!s)return"pending";let e=s.sources_metadata;if(!e||!Array.isArray(e))return"pending";let t=e.map(e=>e.state);return t.every(e=>"RUNNING"===e)?"running":t.every(e=>"MUTED"===e)?"muted":"warning"}return"pending"}},G={async checkConnection(e){try{return e?await L.getStatus(e):await U.list(),!0}catch(e){return console.error("API连接检查失败:",e),!1}},formatError:e=>e instanceof D||e instanceof Error?e.message:"未知错误"};var M=t(1539),F=t(3904),K=t(6517),V=t(4449);function J(e){var s;let{selectedPipeline:t,onPipelineChange:n,onStatusUpdate:l}=e,[i,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[h,b]=(0,r.useState)(null),[w,v]=(0,r.useState)(!0),y=async()=>{try{u(!0),b(null),console.log("正在获取Pipeline列表...");let e=await U.listWithStatus();console.log("获取到Pipeline列表:",e),c(e),v(!0),e.length>0&&!t&&n(e[0].id)}catch(e){console.error("获取Pipeline列表失败:",e),b(G.formatError(e)),v(!1)}finally{u(!1)}},C=async()=>{try{let e=await G.checkConnection();v(e),e||b("无法连接到后端API服务")}catch(e){v(!1),b("API连接检查失败")}};return((0,r.useEffect)(()=>{(async()=>{await C(),w&&await y()})();let e=setInterval(async()=>{await C(),w&&await y()},6e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{i.length>0&&(null==l||l(i))},[i,l]),d)?(0,a.jsxs)(f,{className:"w-full max-w-md",children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(M.A,{className:"h-5 w-5"}),"Pipeline选择器",(0,a.jsx)(E,{variant:"outline",className:"ml-auto",children:"API模式"})]}),(0,a.jsx)(g,{children:"选择要监控的推理管道"})]}),(0,a.jsx)(N,{children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(F.A,{className:"h-6 w-6 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-muted-foreground",children:"连接API中..."})]})})]}):h?(0,a.jsxs)(f,{className:"w-full max-w-md border-red-200",children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2 text-red-600",children:[(0,a.jsx)(M.A,{className:"h-5 w-5"}),"Pipeline选择器",(0,a.jsxs)(E,{variant:"destructive",className:"ml-auto",children:[w?(0,a.jsx)(K.A,{className:"h-3 w-3"}):(0,a.jsx)(V.A,{className:"h-3 w-3"}),w?"已连接":"连接失败"]})]}),(0,a.jsx)(g,{className:"text-red-500",children:h})]}),(0,a.jsx)(N,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:y,disabled:d,className:"w-full px-4 py-2 text-sm bg-red-50 text-red-600 rounded-md hover:bg-red-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"重试中...":"重试"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center",children:"请确保后端API服务正在运行"})]})})]}):0===i.length?(0,a.jsxs)(f,{className:"w-full max-w-md",children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(M.A,{className:"h-5 w-5"}),"Pipeline选择器",(0,a.jsxs)(E,{variant:"outline",className:"ml-auto",children:[(0,a.jsx)(K.A,{className:"h-3 w-3 mr-1"}),"已连接"]})]}),(0,a.jsx)(g,{children:"选择要监控的推理管道"})]}),(0,a.jsx)(N,{children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"暂无可用的Pipeline"}),(0,a.jsx)("button",{onClick:y,className:"mt-2 px-4 py-2 text-sm bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 transition-colors",children:"刷新列表"})]})})]}):(0,a.jsxs)(f,{className:"w-full max-w-md",children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(M.A,{className:"h-5 w-5"}),"Pipeline选择器",(0,a.jsxs)(E,{variant:"outline",className:"ml-auto",children:[(0,a.jsx)(K.A,{className:"h-3 w-3 mr-1"}),"API模式"]})]}),(0,a.jsxs)(g,{children:["选择要监控的推理管道 (",i.length," 个可用)"]})]}),(0,a.jsxs)(N,{className:"space-y-4",children:[(0,a.jsxs)(A,{value:t||"",onValueChange:n,children:[(0,a.jsx)(S,{children:(0,a.jsx)(k,{placeholder:"选择Pipeline"})}),(0,a.jsx)(R,{children:i.map(e=>(0,a.jsx)(_,{value:e.id,children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("span",{className:"font-medium",children:e.name||e.id}),(0,a.jsx)(E,{variant:"secondary",className:"ml-2 ".concat(o(e.status)," ").concat(m(e.status)),children:x(e.status)})]})},e.id))})]}),t&&(0,a.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"当前选择:"}),(0,a.jsx)("button",{onClick:y,className:"text-xs text-blue-600 hover:text-blue-800 transition-colors",children:"刷新"})]}),(0,a.jsx)("div",{className:"mt-1 text-sm text-muted-foreground",children:(null==(s=i.find(e=>e.id===t))?void 0:s.name)||t}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:["ID: ",t]}),i.find(e=>e.id===t)&&(0,a.jsx)(E,{variant:"secondary",className:"mt-2 ".concat(o(i.find(e=>e.id===t).status)," ").concat(m(i.find(e=>e.id===t).status)),children:x(i.find(e=>e.id===t).status)})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center",children:"数据每60秒自动刷新"})]})]})}let B=r.forwardRef((e,s)=>{let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:d("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});B.displayName="Input";var Y=t(9803),Z=t(1154),q=t(381),H=t(5339),Q=t(5690),X=t(8979);function $(e){let{pipelineId:s}=e,[t,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)("disconnected"),[c,d]=(0,r.useState)(null),[o,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)([]),[b,w]=(0,r.useState)("source_image"),[v,y]=(0,r.useState)(!1),[C,P]=(0,r.useState)(0),I=(0,r.useRef)(null),T=(0,r.useRef)(null),D=(0,r.useRef)(null),z=()=>{T.current&&(T.current.close(),T.current=null),D.current&&(D.current.getTracks().forEach(e=>e.stop()),D.current=null),I.current&&(I.current.srcObject=null),i("disconnected"),n(!1)};(0,r.useEffect)(()=>{(async()=>{if(!s){u([]),w("source_image");return}try{y(!0);let e=(await U.getInfo(s)).data.parameters.output_image_fields||[],t=["source_image",...e.filter(e=>"source_image"!==e)];u(t),w("source_image")}catch(e){console.error("获取Pipeline信息失败:",e),u(["source_image"]),w("source_image")}finally{y(!1)}})()},[s]);let L=async()=>{try{m(!0),d(null),i("connecting"),console.log("创建WebRTC连接...");let e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});T.current=e,e.onconnectionstatechange=()=>{switch(console.log("WebRTC连接状态:",e.connectionState),e.connectionState){case"connected":i("connected"),n(!0),d(null);break;case"disconnected":case"failed":i("failed"),d("WebRTC连接失败");break;case"connecting":i("connecting")}},e.oniceconnectionstatechange=()=>{console.log("ICE连接状态:",e.iceConnectionState)},e.ontrack=e=>{console.log("收到远程流:",e.streams[0]),I.current&&e.streams[0]&&(I.current.srcObject=e.streams[0])};let t=await e.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});if(await e.setLocalDescription(t),console.log("本地SDP Offer:",t),!s)throw Error("Pipeline ID为空");let a={webrtc_offer:{sdp:t.sdp,type:"offer"}};"source_image"!==b&&(a.stream_output=[b]),C>0&&(a.webcam_fps=C),console.log("发送的offer请求:",a);let r=await U.createWebRTCOffer(s,a);console.log("收到后端SDP Answer:",r),await e.setRemoteDescription({type:"answer",sdp:r.sdp}),console.log("WebRTC连接建立成功")}catch(e){console.error("WebRTC连接失败:",e),d(G.formatError(e)),i("failed"),z()}finally{m(!1)}},W=async()=>{if(!s)return void d("请先选择一个Pipeline");await L()},O=()=>{console.log("停止视频流"),z(),d(null)};return(0,r.useEffect)(()=>()=>{z()},[]),(0,r.useEffect)(()=>{t&&O()},[s]),(0,a.jsxs)(f,{className:"w-full",children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(Y.A,{className:"h-5 w-5"}),"实时视频流",(0,a.jsxs)(E,{variant:"outline",className:"ml-auto",children:[(0,a.jsx)(K.A,{className:"h-3 w-3 mr-1"}),"WebRTC模式"]})]}),(0,a.jsx)(g,{children:s?"Pipeline: ".concat(s):"请选择Pipeline以开始视频流"})]}),(0,a.jsxs)(N,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat((()=>{switch(l){case"connected":return"bg-green-500";case"connecting":return"bg-yellow-500";case"failed":return"bg-red-500";default:return"bg-gray-500"}})())}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"连接状态"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm",children:(()=>{switch(l){case"connected":return"已连接";case"connecting":return"连接中";case"failed":return"连接失败";default:return"未连接"}})()}),o&&(0,a.jsx)(Z.A,{className:"h-4 w-4 animate-spin"}),"connected"===l&&(0,a.jsx)(K.A,{className:"h-4 w-4 text-green-600"}),"failed"===l&&(0,a.jsx)(V.A,{className:"h-4 w-4 text-red-600"})]})]}),s&&x.length>0&&(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(q.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"视频输出"})]}),(0,a.jsxs)(A,{value:b,onValueChange:w,disabled:t||v,children:[(0,a.jsx)(S,{className:"w-full",children:(0,a.jsx)(k,{placeholder:"选择输出类型"})}),(0,a.jsx)(R,{children:x.map(e=>(0,a.jsx)(_,{value:e,children:"source_image"===e?"原视频":e},e))})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(q.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"帧率设置"})]}),(0,a.jsx)(B,{id:"web-fps",type:"number",min:"0",max:"60",value:C,onChange:e=>P(Number(e.target.value)),disabled:t,placeholder:"输入帧率，0为默认",className:"w-full"})]})]}),(t||s&&x.length>0)&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground space-y-1 px-3",children:[t&&(0,a.jsx)("p",{children:"• 流传输时无法更改设置，请先停止播放"}),(0,a.jsx)("p",{children:"• 帧率设置: 0表示使用默认帧率，建议范围1-30"}),s&&x.length>0&&(0,a.jsx)("p",{children:"• 视频输出: 原视频为摄像头原始画面，其他为AI处理后的结果"})]}),(0,a.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden",style:{aspectRatio:"16/9"},children:[(0,a.jsx)("video",{ref:I,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-contain",style:{backgroundColor:"#000"}}),!t&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)(Y.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm opacity-75",children:s?"点击开始播放视频流":"请选择Pipeline"})]})}),o&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/70",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)(Z.A,{className:"h-8 w-8 mx-auto mb-2 animate-spin"}),(0,a.jsx)("p",{className:"text-sm",children:"正在建立WebRTC连接..."})]})})]}),c&&(0,a.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[(0,a.jsx)(H.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"font-medium",children:"连接错误"})]}),(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:c})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[t?(0,a.jsxs)(h,{onClick:O,variant:"destructive",className:"flex-1",children:[(0,a.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"停止播放"]}):(0,a.jsxs)(h,{onClick:W,disabled:!s||o,className:"flex-1",children:[(0,a.jsx)(Q.A,{className:"h-4 w-4 mr-2"}),o?"连接中...":"开始播放"]}),c&&(0,a.jsx)(h,{onClick:W,variant:"outline",disabled:!s||o,children:"重试"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,a.jsx)("div",{children:"• 使用WebRTC协议进行实时视频传输"}),(0,a.jsx)("div",{children:"• 支持自适应码率和低延迟播放"}),(0,a.jsx)("div",{children:"• 需要Pipeline处于运行状态"}),s&&(0,a.jsxs)("div",{children:["• 当前Pipeline: ",(0,a.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:s})]}),x.length>0&&(0,a.jsxs)("div",{children:["• 当前输出类型: ",(0,a.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:"source_image"===b?"原视频":b})]}),C>0&&(0,a.jsxs)("div",{children:["• 当前帧率: ",(0,a.jsxs)("code",{className:"bg-gray-100 px-1 rounded",children:[C," FPS"]})]})]})]})]})}var ee=t(237),es=t(4416);let et=ee.bL;ee.l9;let ea=ee.ZL;ee.bm;let er=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(ee.hJ,{ref:s,className:d("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});er.displayName=ee.hJ.displayName;let en=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{}),(0,a.jsxs)(ee.UC,{ref:s,className:d("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[r,(0,a.jsxs)(ee.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(es.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});en.displayName=ee.UC.displayName;let el=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:d("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};el.displayName="DialogHeader";let ei=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:d("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};ei.displayName="DialogFooter";let ec=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(ee.hE,{ref:s,className:d("text-lg font-semibold leading-none tracking-tight",t),...r})});ec.displayName=ee.hE.displayName;let ed=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(ee.VY,{ref:s,className:d("text-sm text-muted-foreground",t),...r})});ed.displayName=ee.VY.displayName;var eo=t(3540),em=t(2151),ex=t(4754),eu=t(6025),eh=t(2071),ef=t(9754),ep=t(2319),ej=t(5989),eg=t(3109),eN=t(4186),eb=t(2713),ew=t(6561),ev=t(9397);function ey(e){let{isOpen:s,onClose:t,pipelineId:n}=e,[l,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[o,m]=(0,r.useState)(null),[x,u]=(0,r.useState)("5"),[b,w]=(0,r.useState)(!1),v=async()=>{if(n)try{i(!0),d(null),console.log("正在获取Pipeline ".concat(n," 的指标数据..."));let e=parseInt(x),s=await U.getMetrics(n,{minutes:e});console.log("获取到指标数据:",s),m(s)}catch(e){console.error("获取指标数据失败:",e),d(G.formatError(e))}finally{i(!1)}},y=async()=>{w(!0),await v(),w(!1)};(0,r.useEffect)(()=>{s&&n&&v()},[s,n,x]);let C=o&&o.dates&&0!==o.dates.length?o.dates.map((e,s)=>{let t={time:e};return o.datasets.forEach(e=>{e.data&&void 0!==e.data[s]&&(t[e.name]=e.data[s])}),t}):[],P=o&&o.datasets?o.datasets.filter(e=>e.data&&e.data.length>0&&(e.name.includes("Frame Decoding")||e.name.includes("Inference Latency")||e.name.includes("E2E Latency"))):[],I=o&&o.datasets?o.datasets.filter(e=>e.data&&e.data.length>0&&e.name.includes("Throughput")):[],T=o&&o.datasets?o.datasets.filter(e=>e.data&&e.data.length>0&&e.name.includes("State")):[],D=o&&o.datasets?o.datasets.filter(e=>e.data&&e.data.length>0&&"number"==typeof e.data[0]&&!e.name.includes("Frame Decoding")&&!e.name.includes("Inference Latency")&&!e.name.includes("E2E Latency")&&!e.name.includes("Throughput")):[],z=o?o.dates&&0!==o.dates.length&&0!==T.length?o.dates.map((e,s)=>{let t={time:e};return T.forEach(e=>{if(e.data&&void 0!==e.data[s]){let a=e.data[s],r=0;switch(a){case"NOT_STARTED":default:r=0;break;case"INITIALISING":r=1;break;case"RESTARTING":r=2;break;case"RUNNING":r=3;break;case"PAUSED":r=4;break;case"MUTED":r=5;break;case"TERMINATING":r=6;break;case"ENDED":r=7;break;case"ERROR":r=8}t[e.name]=r,t["".concat(e.name,"_label")]=a}}),t}):[]:[],L=["#8884d8","#82ca9d","#ffc658","#ff7c7c","#8dd1e1","#d084d0","#ffb347","#87ceeb","#dda0dd","#98fb98"];return(0,a.jsx)(et,{open:s,onOpenChange:t,children:(0,a.jsxs)(en,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(el,{children:[(0,a.jsxs)(ec,{className:"flex items-center gap-2",children:[(0,a.jsx)(eg.A,{className:"h-5 w-5"}),"Pipeline 指标监控",(0,a.jsx)(E,{variant:"outline",className:"ml-auto",children:"API模式"})]}),(0,a.jsx)(ed,{children:n?"Pipeline: ".concat(n):"未选择Pipeline"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eN.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"时间范围:"}),(0,a.jsxs)(A,{value:x,onValueChange:u,children:[(0,a.jsx)(S,{className:"w-32",children:(0,a.jsx)(k,{})}),(0,a.jsxs)(R,{children:[(0,a.jsx)(_,{value:"1",children:"1分钟"}),(0,a.jsx)(_,{value:"5",children:"5分钟"}),(0,a.jsx)(_,{value:"15",children:"15分钟"}),(0,a.jsx)(_,{value:"30",children:"30分钟"}),(0,a.jsx)(_,{value:"60",children:"1小时"})]})]})]})}),(0,a.jsxs)(h,{onClick:y,disabled:l||b,size:"sm",variant:"outline",children:[(0,a.jsx)(F.A,{className:"h-4 w-4 mr-2 ".concat(b?"animate-spin":"")}),b?"刷新中...":"刷新"]})]}),l&&(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)(F.A,{className:"h-6 w-6 animate-spin text-muted-foreground mr-2"}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"正在加载指标数据..."})]}),c&&(0,a.jsx)(f,{className:"border-red-200",children:(0,a.jsxs)(N,{className:"pt-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[(0,a.jsx)(H.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"font-medium",children:"获取指标数据失败"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:c}),(0,a.jsx)(h,{onClick:v,size:"sm",variant:"outline",className:"mt-3",children:"重试"})]})}),o&&!l&&!c&&(0,a.jsxs)("div",{className:"space-y-6",children:[I.length>0&&C.length>0&&(0,a.jsxs)(f,{children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(eb.A,{className:"h-5 w-5"}),"吞吐量指标"]}),(0,a.jsxs)(g,{children:["过去 ",x," 分钟的吞吐量数据趋势"]})]}),(0,a.jsx)(N,{children:(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(eo.u,{width:"100%",height:"100%",children:(0,a.jsxs)(em.b,{data:C,children:[(0,a.jsx)(ex.d,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.W,{dataKey:"time",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(eh.h,{tick:{fontSize:12}}),(0,a.jsx)(ef.m,{}),(0,a.jsx)(ep.s,{}),I.map((e,s)=>(0,a.jsx)(ej.N,{type:"monotone",dataKey:e.name,stroke:L[s%L.length],strokeWidth:2,dot:!1,connectNulls:!1},e.name))]})})})})]}),P.length>0&&C.length>0&&(0,a.jsxs)(f,{children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(ew.A,{className:"h-5 w-5"}),"延迟指标"]}),(0,a.jsxs)(g,{children:["过去 ",x," 分钟的延迟数据趋势（包括帧解码、推理和端到端延迟）"]})]}),(0,a.jsx)(N,{children:(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(eo.u,{width:"100%",height:"100%",children:(0,a.jsxs)(em.b,{data:C,children:[(0,a.jsx)(ex.d,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.W,{dataKey:"time",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(eh.h,{tick:{fontSize:12}}),(0,a.jsx)(ef.m,{}),(0,a.jsx)(ep.s,{}),P.map((e,s)=>(0,a.jsx)(ej.N,{type:"monotone",dataKey:e.name,stroke:L[s%L.length],strokeWidth:2,dot:!1,connectNulls:!1},e.name))]})})})})]}),T.length>0&&z.length>0&&(0,a.jsxs)(f,{children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(ev.A,{className:"h-5 w-5"}),"状态时间线"]}),(0,a.jsxs)(g,{children:["过去 ",x," 分钟的Pipeline组件状态变化"]})]}),(0,a.jsxs)(N,{children:[(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(eo.u,{width:"100%",height:"100%",children:(0,a.jsxs)(em.b,{data:z,children:[(0,a.jsx)(ex.d,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.W,{dataKey:"time",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(eh.h,{tick:{fontSize:12},domain:[0,8],tickFormatter:e=>{switch(e){case 0:return"NOT_STARTED";case 1:return"INITIALISING";case 2:return"RESTARTING";case 3:return"RUNNING";case 4:return"PAUSED";case 5:return"MUTED";case 6:return"TERMINATING";case 7:return"ENDED";case 8:return"ERROR";default:return""}}}),(0,a.jsx)(ef.m,{content:(0,a.jsx)(e=>{let{active:s,payload:t,label:r}=e;return s&&t&&t.length?(0,a.jsxs)("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[(0,a.jsx)("p",{className:"font-medium",children:"时间: ".concat(r)}),t.map((e,s)=>{let t="".concat(e.dataKey,"_label"),r=e.payload[t]||"unknown";return(0,a.jsx)("p",{style:{color:e.color},children:"".concat(e.dataKey.replace(" ("," ("),": ").concat(r)},s)})]}):null},{})}),(0,a.jsx)(ep.s,{}),T.map((e,s)=>(0,a.jsx)(ej.N,{type:"stepAfter",dataKey:e.name,stroke:L[s%L.length],strokeWidth:2,dot:{r:3},connectNulls:!1},e.name))]})})}),(0,a.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,a.jsxs)(E,{variant:"outline",className:"bg-gray-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-500 mr-1"}),"NOT_STARTED"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-blue-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 mr-1"}),"INITIALISING"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-orange-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-orange-500 mr-1"}),"RESTARTING"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-green-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500 mr-1"}),"RUNNING"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-yellow-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-yellow-500 mr-1"}),"PAUSED"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-purple-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-purple-500 mr-1"}),"MUTED"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-pink-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-pink-500 mr-1"}),"TERMINATING"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-slate-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-slate-500 mr-1"}),"ENDED"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-red-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500 mr-1"}),"ERROR"]})]})]})]}),D.length>0&&C.length>0&&(0,a.jsxs)(f,{children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(M.A,{className:"h-5 w-5"}),"其他性能指标"]}),(0,a.jsxs)(g,{children:["过去 ",x," 分钟的其他性能数据趋势"]})]}),(0,a.jsx)(N,{children:(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(eo.u,{width:"100%",height:"100%",children:(0,a.jsxs)(em.b,{data:C,children:[(0,a.jsx)(ex.d,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.W,{dataKey:"time",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(eh.h,{tick:{fontSize:12}}),(0,a.jsx)(ef.m,{}),(0,a.jsx)(ep.s,{}),D.map((e,s)=>(0,a.jsx)(ej.N,{type:"monotone",dataKey:e.name,stroke:L[s%L.length],strokeWidth:2,dot:!1,connectNulls:!1},e.name))]})})})})]}),(0,a.jsxs)(f,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(j,{children:"数据统计"})}),(0,a.jsx)(N,{children:(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:o.dates.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"数据点"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:I.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"吞吐量指标"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:P.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"延迟指标"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:T.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"状态指标"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-gray-600",children:[x,"min"]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"时间范围"})]})]})})]})]}),o&&!l&&!c&&0===C.length&&(0,a.jsx)(f,{children:(0,a.jsx)(N,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(ev.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"暂无指标数据"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"所选时间范围内没有找到指标数据"}),(0,a.jsx)(h,{onClick:v,size:"sm",children:"重新加载"})]})})})]})]})})}var eA=t(1066),ek=t(5880),eS=t(505),eC=t(1788);let eP=[{key:"created_at",label:"按创建时间(新→旧)"},{key:"modified_at",label:"按修改时间(新→旧)"},{key:"size_bytes",label:"按大小(大→小)"},{key:"filename",label:"按文件名(A→Z)"}];function eR(e){let{pipelineId:s}=e,[t,n]=(0,r.useState)([]),[l,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[o,m]=(0,r.useState)(null),[x,u]=(0,r.useState)("records"),[b,w]=(0,r.useState)("created_at"),[v,y]=(0,r.useState)(""),C=async()=>{if(s)try{i(!0),d(null);let e=await W.list(s,x);n(e),e.length>0&&!o&&m(e[0].filename)}catch(e){d(G.formatError(e))}finally{i(!1)}};(0,r.useEffect)(()=>{n([]),m(null),s&&C()},[s,x]);let P=(0,r.useMemo)(()=>[...t.filter(e=>e.filename.toLowerCase().includes(v.toLowerCase()))].sort((e,s)=>{switch(b){case"created_at":return s.created_at-e.created_at;case"modified_at":return s.modified_at-e.modified_at;case"size_bytes":return s.size_bytes-e.size_bytes;case"filename":return e.filename.localeCompare(s.filename);default:return 0}}),[t,b,v]),I=(0,r.useMemo)(()=>s&&o?W.videoUrl(s,o,x):"",[s,o,x]),T=e=>e>=0x40000000?"".concat((e/0x40000000).toFixed(2)," GB"):e>=1048576?"".concat((e/1048576).toFixed(2)," MB"):e>=1024?"".concat((e/1024).toFixed(2)," KB"):"".concat(e," B");return(0,a.jsxs)(f,{className:"w-full",children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(eA.A,{className:"h-5 w-5"}),"录像回放",(0,a.jsxs)(E,{variant:"outline",className:"ml-auto",children:[(0,a.jsx)(ek.A,{className:"h-3 w-3 mr-1"}),"本地文件"]})]}),(0,a.jsx)(g,{children:s?"Pipeline: ".concat(s):"请选择Pipeline以查看录像"})]}),(0,a.jsxs)(N,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 p-3 bg-muted rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(B,{placeholder:"搜索文件名...",value:v,onChange:e=>y(e.target.value)})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eS.A,{className:"h-4 w-4"}),(0,a.jsxs)(A,{value:b,onValueChange:e=>w(e),children:[(0,a.jsx)(S,{className:"w-full",children:(0,a.jsx)(k,{placeholder:"排序"})}),(0,a.jsx)(R,{children:eP.map(e=>(0,a.jsx)(_,{value:e.key,children:e.label},e.key))})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(h,{variant:"outline",onClick:C,disabled:!s||l,children:(0,a.jsx)(F.A,{className:"h-4 w-4 ".concat(l?"animate-spin":"")})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4",children:[(0,a.jsx)("div",{className:"lg:col-span-5",children:(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsxs)("div",{className:"max-h-[420px] overflow-auto divide-y",children:[0===P.length&&(0,a.jsx)("div",{className:"p-4 text-sm text-muted-foreground",children:s?"暂无录像文件":"请选择Pipeline"}),P.map(e=>(0,a.jsxs)("div",{onClick:()=>m(e.filename),className:"p-3 cursor-pointer hover:bg-muted/60 ".concat(o===e.filename?"bg-muted":""),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"truncate font-medium",children:e.filename}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground ml-2",children:T(e.size_bytes)})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["创建: ",new Date(1e3*e.created_at).toLocaleString()," | 更新: ",new Date(1e3*e.modified_at).toLocaleString()]})]},e.filename))]})})}),(0,a.jsxs)("div",{className:"lg:col-span-7",children:[(0,a.jsx)("div",{className:"relative bg-black rounded-lg overflow-hidden",style:{aspectRatio:"16/9"},children:I?(0,a.jsx)("video",{src:I,controls:!0,controlsList:"nodownload noplaybackrate",className:"w-full h-full object-contain"},I):(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)(eA.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm opacity-75",children:s?"选择左侧文件播放录像":"请选择Pipeline"})]})})}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-3",children:[(0,a.jsxs)(h,{onClick:()=>I&&window.open(I,"_blank"),disabled:!I,children:[(0,a.jsx)(Q.A,{className:"h-4 w-4 mr-2"}),"在新窗口播放"]}),(0,a.jsxs)("a",{href:I,download:!0,className:"inline-flex items-center justify-center h-10 px-4 py-2 rounded-md border text-sm font-medium ".concat(I?"bg-white hover:bg-gray-50":"pointer-events-none opacity-50"),children:[(0,a.jsx)(eC.A,{className:"h-4 w-4 mr-2"}),"下载视频"]})]})]})]})]})]})}function e_(e){let{isOpen:s,onClose:t,defaultPipelineId:n}=e,[l,i]=(0,r.useState)("");return(0,r.useEffect)(()=>{s&&i(n||"")},[s,n]),(0,a.jsx)(et,{open:s,onOpenChange:e=>!e&&t(),children:(0,a.jsxs)(en,{className:"max-w-5xl",children:[(0,a.jsx)(el,{children:(0,a.jsxs)(ec,{className:"flex items-center gap-2",children:[(0,a.jsx)(Y.A,{className:"h-5 w-5"}),"查看录像"]})}),(0,a.jsx)("div",{className:"space-y-3",children:(0,a.jsx)(eR,{pipelineId:l||null})}),(0,a.jsx)(ei,{children:(0,a.jsx)(h,{variant:"outline",onClick:t,children:"关闭"})})]})})}var eI=t(741),eE=t(1284);function eT(){let[e,s]=(0,r.useState)(null),[t,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)(!1);return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:[(0,a.jsx)("header",{className:"bg-white/80 backdrop-blur-sm border-b border-white/20 sticky top-0 z-40",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)(q.A,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Coral Inference Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"实时推理管道监控与控制面板"})]})]}),e&&(0,a.jsxs)(h,{onClick:()=>n(!0),className:"bg-blue-600 hover:bg-blue-700 text-white shadow-lg",children:[(0,a.jsx)(eI.A,{className:"h-4 w-4 mr-2"}),"查看指标"]})]})})}),(0,a.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-4 space-y-6",children:[(0,a.jsx)(J,{selectedPipeline:e,onPipelineChange:s}),(0,a.jsxs)(f,{className:"bg-white/70 backdrop-blur-sm border-white/20",children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(eE.A,{className:"h-5 w-5"}),"系统信息"]}),(0,a.jsx)(g,{children:"当前系统状态概览"})]}),(0,a.jsx)(N,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"系统状态"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-600",children:"正常运行"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"API服务"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-600",children:"已连接"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"WebRTC支持"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-600",children:"已启用"})]}),e&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"活动Pipeline"}),(0,a.jsx)("span",{className:"text-sm font-medium text-blue-600",children:e})]})]})})]}),(0,a.jsxs)(f,{className:"bg-white/70 backdrop-blur-sm border-white/20",children:[(0,a.jsxs)(p,{children:[(0,a.jsx)(j,{children:"快速操作"}),(0,a.jsx)(g,{children:"常用功能快捷入口"})]}),(0,a.jsx)(N,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(h,{variant:"outline",className:"w-full justify-start",onClick:()=>n(!0),disabled:!e,children:[(0,a.jsx)(eI.A,{className:"h-4 w-4 mr-2"}),"查看性能指标"]}),(0,a.jsxs)(h,{variant:"outline",className:"w-full justify-start",onClick:()=>i(!0),disabled:!e,children:[(0,a.jsx)(q.A,{className:"h-4 w-4 mr-2"}),"查看录像"]})]})})]})]}),(0,a.jsx)("div",{className:"lg:col-span-8 space-y-6",children:(0,a.jsx)($,{pipelineId:e})})]}),(0,a.jsxs)("div",{className:"mt-12 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Coral Inference Dashboard - 实时推理管道监控系统"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"支持WebRTC视频流、实时性能监控和Pipeline管理"})]})]}),(0,a.jsx)(ey,{isOpen:t,onClose:()=>n(!1),pipelineId:e}),(0,a.jsx)(e_,{isOpen:l,onClose:()=>i(!1),defaultPipelineId:e})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[377,441,684,358],()=>s(2801)),_N_E=e.O()}]);