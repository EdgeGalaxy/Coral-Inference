(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2801:(e,s,t)=>{Promise.resolve().then(t.bind(t,6171))},6171:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ew});var a=t(5155),r=t(2115),n=t(9708),l=t(2085),c=t(2596),i=t(9688);function d(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,i.QP)((0,c.$)(s))}t(9509);let o=e=>{switch(null==e?void 0:e.toLowerCase()){case"running":return"bg-green-500";case"stopped":return"bg-red-500";case"paused":return"bg-yellow-500";case"error":return"bg-red-600";default:return"bg-gray-500"}},m=e=>{switch(null==e?void 0:e.toLowerCase()){case"running":return"text-green-600";case"stopped":return"text-red-600";case"paused":return"text-yellow-600";case"error":return"text-red-700";default:return"text-gray-600"}},x=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=r.forwardRef((e,s)=>{let{className:t,variant:r,size:l,asChild:c=!1,...i}=e,o=c?n.DX:"button";return(0,a.jsx)(o,{className:d(x({variant:r,size:l,className:t})),ref:s,...i})});u.displayName="Button";let h=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:d("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});h.displayName="Card";let f=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:d("flex flex-col space-y-1.5 p-6",t),...r})});f.displayName="CardHeader";let j=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h3",{ref:s,className:d("text-2xl font-semibold leading-none tracking-tight",t),...r})});j.displayName="CardTitle";let g=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("p",{ref:s,className:d("text-sm text-muted-foreground",t),...r})});g.displayName="CardDescription";let p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:d("p-6 pt-0",t),...r})});p.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:d("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter";var N=t(5713),b=t(6474),w=t(7863),y=t(5196);let v=N.bL;N.YJ;let A=N.WT,k=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(N.l9,{ref:s,className:d("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[r,(0,a.jsx)(N.In,{asChild:!0,children:(0,a.jsx)(b.A,{className:"h-4 w-4 opacity-50"})})]})});k.displayName=N.l9.displayName;let R=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(N.PP,{ref:s,className:d("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(w.A,{className:"h-4 w-4"})})});R.displayName=N.PP.displayName;let P=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(N.wn,{ref:s,className:d("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(b.A,{className:"h-4 w-4"})})});P.displayName=N.wn.displayName;let C=r.forwardRef((e,s)=>{let{className:t,children:r,position:n="popper",...l}=e;return(0,a.jsx)(N.ZL,{children:(0,a.jsxs)(N.UC,{ref:s,className:d("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...l,children:[(0,a.jsx)(R,{}),(0,a.jsx)(N.LM,{className:d("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(P,{})]})})});C.displayName=N.UC.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(N.JU,{ref:s,className:d("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=N.JU.displayName;let S=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(N.q7,{ref:s,className:d("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(N.VF,{children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})}),(0,a.jsx)(N.p4,{children:r})]})});S.displayName=N.q7.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(N.wv,{ref:s,className:d("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=N.wv.displayName;let I=(0,l.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-500/80",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-500/80",error:"border-transparent bg-red-500 text-white hover:bg-red-500/80"}},defaultVariants:{variant:"default"}});function E(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:d(I({variant:t}),s),...r})}let T=t(9509).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:9001";class _ extends Error{constructor(e,s,t){super(e),this.status=s,this.response=t,this.name="ApiError"}}async function D(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat(T).concat(e),a={headers:{"Content-Type":"application/json",...s.headers},...s};try{console.log("API请求: ".concat(s.method||"GET"," ").concat(t));let e=await fetch(t,a);if(!e.ok){let s=await e.text();throw new _("API请求失败: ".concat(e.status," ").concat(e.statusText).concat(s?" - ".concat(s):""),e.status,e)}let r=await e.json();return console.log("API响应:",r),r}catch(e){if(e instanceof _)throw e;throw console.error("API请求错误:",e),new _("网络错误: ".concat(e instanceof Error?e.message:"未知错误"),0)}}let W={async list(){try{return(await D("/inference_pipelines/list")).fixed_pipelines.map(e=>({id:e,status:"running"}))}catch(e){throw console.error("获取Pipeline列表失败:",e),e}},async getInfo(e){try{return await D("/inference_pipelines/".concat(e,"/info"))}catch(e){throw console.error("获取Pipeline信息失败:",e),e}},async getMetrics(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{minutes:5};try{let t=new URLSearchParams;s.start&&t.append("start_time",s.start.toString()),s.end&&t.append("end_time",s.end.toString()),s.minutes&&t.append("minutes",s.minutes.toString());let a=t.toString(),r="/inference_pipelines/".concat(e,"/metrics").concat(a?"?".concat(a):"");return await D(r)}catch(e){throw console.error("获取Pipeline指标失败:",e),e}},async createWebRTCOffer(e,s){try{let t=JSON.stringify(s);return console.log("发送的请求体:",t),await D("/inference_pipelines/".concat(e,"/offer"),{method:"POST",body:t})}catch(e){throw console.error("创建WebRTC连接失败:",e),e}}},z={async getStatus(e){try{return await D("/inference_pipelines/".concat(e,"/status"))}catch(e){throw console.error("获取Pipeline状态失败:",e),e}},async getDiskUsage(){try{return(await D("/monitor/disk-usage")).data}catch(e){throw console.error("获取磁盘使用情况失败:",e),e}},async flushCache(){try{return await D("/monitor/flush-cache",{method:"POST"})}catch(e){throw console.error("刷新缓存失败:",e),e}},async triggerCleanup(){try{return await D("/monitor/cleanup",{method:"POST"})}catch(e){throw console.error("触发清理失败:",e),e}},async getMonitorStatus(){try{return(await D("/monitor/status")).data}catch(e){throw console.error("获取监控器状态失败:",e),e}}},O={async checkConnection(e){try{return e?await z.getStatus(e):await W.list(),!0}catch(e){return console.error("API连接检查失败:",e),!1}},formatError:e=>e instanceof _||e instanceof Error?e.message:"未知错误"};var U=t(1539),L=t(3904),G=t(6517),K=t(4449);function M(e){let{selectedPipeline:s,onPipelineChange:t,onStatusUpdate:n}=e,[l,c]=(0,r.useState)([]),[i,d]=(0,r.useState)(!0),[x,u]=(0,r.useState)(null),[N,b]=(0,r.useState)(!0),w=async()=>{try{d(!0),u(null),console.log("正在获取Pipeline列表...");let e=await W.list();console.log("获取到Pipeline列表:",e),c(e),b(!0),e.length>0&&!s&&t(e[0].id)}catch(e){console.error("获取Pipeline列表失败:",e),u(O.formatError(e)),b(!1)}finally{d(!1)}},y=async()=>{try{let e=await O.checkConnection();b(e),e||u("无法连接到后端API服务")}catch(e){b(!1),u("API连接检查失败")}};return((0,r.useEffect)(()=>{(async()=>{await y(),N&&await w()})();let e=setInterval(async()=>{await y(),N&&await w()},1e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{l.length>0&&(null==n||n(l))},[l,n]),i)?(0,a.jsxs)(h,{className:"w-full max-w-md",children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(U.A,{className:"h-5 w-5"}),"Pipeline选择器",(0,a.jsx)(E,{variant:"outline",className:"ml-auto",children:"API模式"})]}),(0,a.jsx)(g,{children:"选择要监控的推理管道"})]}),(0,a.jsx)(p,{children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(L.A,{className:"h-6 w-6 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-muted-foreground",children:"连接API中..."})]})})]}):x?(0,a.jsxs)(h,{className:"w-full max-w-md border-red-200",children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2 text-red-600",children:[(0,a.jsx)(U.A,{className:"h-5 w-5"}),"Pipeline选择器",(0,a.jsxs)(E,{variant:"destructive",className:"ml-auto",children:[N?(0,a.jsx)(G.A,{className:"h-3 w-3"}):(0,a.jsx)(K.A,{className:"h-3 w-3"}),N?"已连接":"连接失败"]})]}),(0,a.jsx)(g,{className:"text-red-500",children:x})]}),(0,a.jsx)(p,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:w,disabled:i,className:"w-full px-4 py-2 text-sm bg-red-50 text-red-600 rounded-md hover:bg-red-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:i?"重试中...":"重试"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center",children:"请确保后端API服务正在运行"})]})})]}):0===l.length?(0,a.jsxs)(h,{className:"w-full max-w-md",children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(U.A,{className:"h-5 w-5"}),"Pipeline选择器",(0,a.jsxs)(E,{variant:"outline",className:"ml-auto",children:[(0,a.jsx)(G.A,{className:"h-3 w-3 mr-1"}),"已连接"]})]}),(0,a.jsx)(g,{children:"选择要监控的推理管道"})]}),(0,a.jsx)(p,{children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"暂无可用的Pipeline"}),(0,a.jsx)("button",{onClick:w,className:"mt-2 px-4 py-2 text-sm bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 transition-colors",children:"刷新列表"})]})})]}):(0,a.jsxs)(h,{className:"w-full max-w-md",children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(U.A,{className:"h-5 w-5"}),"Pipeline选择器",(0,a.jsxs)(E,{variant:"outline",className:"ml-auto",children:[(0,a.jsx)(G.A,{className:"h-3 w-3 mr-1"}),"API模式"]})]}),(0,a.jsxs)(g,{children:["选择要监控的推理管道 (",l.length," 个可用)"]})]}),(0,a.jsxs)(p,{className:"space-y-4",children:[(0,a.jsxs)(v,{value:s||"",onValueChange:t,children:[(0,a.jsx)(k,{children:(0,a.jsx)(A,{placeholder:"选择Pipeline"})}),(0,a.jsx)(C,{children:l.map(e=>(0,a.jsx)(S,{value:e.id,children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("span",{className:"font-medium",children:e.id}),(0,a.jsx)(E,{variant:"secondary",className:"ml-2 ".concat(o(e.status)," ").concat(m(e.status)),children:e.status})]})},e.id))})]}),s&&(0,a.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"当前选择:"}),(0,a.jsx)("button",{onClick:w,className:"text-xs text-blue-600 hover:text-blue-800 transition-colors",children:"刷新"})]}),(0,a.jsx)("div",{className:"mt-1 text-sm text-muted-foreground",children:s}),l.find(e=>e.id===s)&&(0,a.jsx)(E,{variant:"secondary",className:"mt-2 ".concat(o(l.find(e=>e.id===s).status)," ").concat(m(l.find(e=>e.id===s).status)),children:l.find(e=>e.id===s).status})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center",children:"数据每10秒自动刷新"})]})]})}var V=t(9803),F=t(1154),J=t(381),B=t(5339),Y=t(5690),q=t(8979);function H(e){let{pipelineId:s}=e,[t,n]=(0,r.useState)(!1),[l,c]=(0,r.useState)("disconnected"),[i,d]=(0,r.useState)(null),[o,m]=(0,r.useState)(!1),[x,N]=(0,r.useState)([]),[b,w]=(0,r.useState)("source_image"),[y,R]=(0,r.useState)(!1),P=(0,r.useRef)(null),I=(0,r.useRef)(null),T=(0,r.useRef)(null),_=()=>{I.current&&(I.current.close(),I.current=null),T.current&&(T.current.getTracks().forEach(e=>e.stop()),T.current=null),P.current&&(P.current.srcObject=null),c("disconnected"),n(!1)};(0,r.useEffect)(()=>{(async()=>{if(!s){N([]),w("source_image");return}try{R(!0);let e=(await W.getInfo(s)).data.parameters.output_image_fields||[],t=["source_image",...e.filter(e=>"source_image"!==e)];N(t),w("source_image")}catch(e){console.error("获取Pipeline信息失败:",e),N(["source_image"]),w("source_image")}finally{R(!1)}})()},[s]);let D=async()=>{try{m(!0),d(null),c("connecting"),console.log("创建WebRTC连接...");let e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});I.current=e,e.onconnectionstatechange=()=>{switch(console.log("WebRTC连接状态:",e.connectionState),e.connectionState){case"connected":c("connected"),n(!0),d(null);break;case"disconnected":case"failed":c("failed"),d("WebRTC连接失败");break;case"connecting":c("connecting")}},e.oniceconnectionstatechange=()=>{console.log("ICE连接状态:",e.iceConnectionState)},e.ontrack=e=>{console.log("收到远程流:",e.streams[0]),P.current&&e.streams[0]&&(P.current.srcObject=e.streams[0])};let t=await e.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});if(await e.setLocalDescription(t),console.log("本地SDP Offer:",t),!s)throw Error("Pipeline ID为空");let a={webrtc_offer:{sdp:t.sdp,type:"offer"}};"source_image"!==b&&(a.stream_output=[b]),console.log("发送的offer请求:",a);let r=await W.createWebRTCOffer(s,a);console.log("收到后端SDP Answer:",r),await e.setRemoteDescription({type:"answer",sdp:r.sdp}),console.log("WebRTC连接建立成功")}catch(e){console.error("WebRTC连接失败:",e),d(O.formatError(e)),c("failed"),_()}finally{m(!1)}},z=async()=>{if(!s)return void d("请先选择一个Pipeline");await D()},U=()=>{console.log("停止视频流"),_(),d(null)};return(0,r.useEffect)(()=>()=>{_()},[]),(0,r.useEffect)(()=>{t&&U()},[s]),(0,a.jsxs)(h,{className:"w-full",children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(V.A,{className:"h-5 w-5"}),"实时视频流",(0,a.jsxs)(E,{variant:"outline",className:"ml-auto",children:[(0,a.jsx)(G.A,{className:"h-3 w-3 mr-1"}),"WebRTC模式"]})]}),(0,a.jsx)(g,{children:s?"Pipeline: ".concat(s):"请选择Pipeline以开始视频流"})]}),(0,a.jsxs)(p,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat((()=>{switch(l){case"connected":return"bg-green-500";case"connecting":return"bg-yellow-500";case"failed":return"bg-red-500";default:return"bg-gray-500"}})())}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"连接状态:"}),(0,a.jsx)("span",{className:"text-sm",children:(()=>{switch(l){case"connected":return"已连接";case"connecting":return"连接中";case"failed":return"连接失败";default:return"未连接"}})()})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[o&&(0,a.jsx)(F.A,{className:"h-4 w-4 animate-spin"}),"connected"===l&&(0,a.jsx)(G.A,{className:"h-4 w-4 text-green-600"}),"failed"===l&&(0,a.jsx)(K.A,{className:"h-4 w-4 text-red-600"})]})]}),s&&x.length>0&&(0,a.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(J.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"视频输出选择:"})]}),(0,a.jsxs)(v,{value:b,onValueChange:w,disabled:t||y,children:[(0,a.jsx)(k,{className:"w-full",children:(0,a.jsx)(A,{placeholder:"选择输出类型"})}),(0,a.jsx)(C,{children:x.map(e=>(0,a.jsx)(S,{value:e,children:"source_image"===e?"原视频":e},e))})]}),t&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"流传输时无法更改输出类型，请先停止播放"})]}),(0,a.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden",style:{aspectRatio:"16/9"},children:[(0,a.jsx)("video",{ref:P,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-contain",style:{backgroundColor:"#000"}}),!t&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)(V.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm opacity-75",children:s?"点击开始播放视频流":"请选择Pipeline"})]})}),o&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/70",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)(F.A,{className:"h-8 w-8 mx-auto mb-2 animate-spin"}),(0,a.jsx)("p",{className:"text-sm",children:"正在建立WebRTC连接..."})]})})]}),i&&(0,a.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[(0,a.jsx)(B.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"font-medium",children:"连接错误"})]}),(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[t?(0,a.jsxs)(u,{onClick:U,variant:"destructive",className:"flex-1",children:[(0,a.jsx)(q.A,{className:"h-4 w-4 mr-2"}),"停止播放"]}):(0,a.jsxs)(u,{onClick:z,disabled:!s||o,className:"flex-1",children:[(0,a.jsx)(Y.A,{className:"h-4 w-4 mr-2"}),o?"连接中...":"开始播放"]}),i&&(0,a.jsx)(u,{onClick:z,variant:"outline",disabled:!s||o,children:"重试"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,a.jsx)("div",{children:"• 使用WebRTC协议进行实时视频传输"}),(0,a.jsx)("div",{children:"• 支持自适应码率和低延迟播放"}),(0,a.jsx)("div",{children:"• 需要Pipeline处于运行状态"}),s&&(0,a.jsxs)("div",{children:["• 当前Pipeline: ",(0,a.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:s})]}),x.length>0&&(0,a.jsxs)("div",{children:["• 当前输出类型: ",(0,a.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:"source_image"===b?"原视频":b})]})]})]})]})}var X=t(237),Z=t(4416);let Q=X.bL;X.l9;let $=X.ZL;X.bm;let ee=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(X.hJ,{ref:s,className:d("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});ee.displayName=X.hJ.displayName;let es=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(ee,{}),(0,a.jsxs)(X.UC,{ref:s,className:d("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[r,(0,a.jsxs)(X.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(Z.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});es.displayName=X.UC.displayName;let et=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:d("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};et.displayName="DialogHeader";let ea=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(X.hE,{ref:s,className:d("text-lg font-semibold leading-none tracking-tight",t),...r})});ea.displayName=X.hE.displayName;let er=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(X.VY,{ref:s,className:d("text-sm text-muted-foreground",t),...r})});er.displayName=X.VY.displayName;var en=t(3540),el=t(2151),ec=t(4754),ei=t(6025),ed=t(2071),eo=t(9754),em=t(2319),ex=t(5989),eu=t(3109),eh=t(4186),ef=t(2713),ej=t(6561),eg=t(9397);function ep(e){let{isOpen:s,onClose:t,pipelineId:n}=e,[l,c]=(0,r.useState)(!1),[i,d]=(0,r.useState)(null),[o,m]=(0,r.useState)(null),[x,N]=(0,r.useState)("5"),[b,w]=(0,r.useState)(!1),y=async()=>{if(n)try{c(!0),d(null),console.log("正在获取Pipeline ".concat(n," 的指标数据..."));let e=parseInt(x),s=await W.getMetrics(n,{minutes:e});console.log("获取到指标数据:",s),m(s)}catch(e){console.error("获取指标数据失败:",e),d(O.formatError(e))}finally{c(!1)}},R=async()=>{w(!0),await y(),w(!1)};(0,r.useEffect)(()=>{s&&n&&y()},[s,n,x]);let P=o&&o.dates&&0!==o.dates.length?o.dates.map((e,s)=>{let t={time:e};return o.datasets.forEach(e=>{e.data&&void 0!==e.data[s]&&(t[e.name]=e.data[s])}),t}):[],I=o&&o.datasets?o.datasets.filter(e=>e.data&&e.data.length>0&&(e.name.includes("Frame Decoding")||e.name.includes("Inference Latency")||e.name.includes("E2E Latency"))):[],T=o&&o.datasets?o.datasets.filter(e=>e.data&&e.data.length>0&&e.name.includes("Throughput")):[],_=o&&o.datasets?o.datasets.filter(e=>e.data&&e.data.length>0&&e.name.includes("State")):[],D=o&&o.datasets?o.datasets.filter(e=>e.data&&e.data.length>0&&"number"==typeof e.data[0]&&!e.name.includes("Frame Decoding")&&!e.name.includes("Inference Latency")&&!e.name.includes("E2E Latency")&&!e.name.includes("Throughput")):[],z=o?o.dates&&0!==o.dates.length&&0!==_.length?o.dates.map((e,s)=>{let t={time:e};return _.forEach(e=>{if(e.data&&void 0!==e.data[s]){let a=e.data[s],r=0;switch(a){case"NOT_STARTED":default:r=0;break;case"INITIALISING":r=1;break;case"RESTARTING":r=2;break;case"RUNNING":r=3;break;case"PAUSED":r=4;break;case"MUTED":r=5;break;case"TERMINATING":r=6;break;case"ENDED":r=7;break;case"ERROR":r=8}t[e.name]=r,t["".concat(e.name,"_label")]=a}}),t}):[]:[],G=["#8884d8","#82ca9d","#ffc658","#ff7c7c","#8dd1e1","#d084d0","#ffb347","#87ceeb","#dda0dd","#98fb98"];return(0,a.jsx)(Q,{open:s,onOpenChange:t,children:(0,a.jsxs)(es,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(et,{children:[(0,a.jsxs)(ea,{className:"flex items-center gap-2",children:[(0,a.jsx)(eu.A,{className:"h-5 w-5"}),"Pipeline 指标监控",(0,a.jsx)(E,{variant:"outline",className:"ml-auto",children:"API模式"})]}),(0,a.jsx)(er,{children:n?"Pipeline: ".concat(n):"未选择Pipeline"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eh.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"时间范围:"}),(0,a.jsxs)(v,{value:x,onValueChange:N,children:[(0,a.jsx)(k,{className:"w-32",children:(0,a.jsx)(A,{})}),(0,a.jsxs)(C,{children:[(0,a.jsx)(S,{value:"1",children:"1分钟"}),(0,a.jsx)(S,{value:"5",children:"5分钟"}),(0,a.jsx)(S,{value:"15",children:"15分钟"}),(0,a.jsx)(S,{value:"30",children:"30分钟"}),(0,a.jsx)(S,{value:"60",children:"1小时"})]})]})]})}),(0,a.jsxs)(u,{onClick:R,disabled:l||b,size:"sm",variant:"outline",children:[(0,a.jsx)(L.A,{className:"h-4 w-4 mr-2 ".concat(b?"animate-spin":"")}),b?"刷新中...":"刷新"]})]}),l&&(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)(L.A,{className:"h-6 w-6 animate-spin text-muted-foreground mr-2"}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"正在加载指标数据..."})]}),i&&(0,a.jsx)(h,{className:"border-red-200",children:(0,a.jsxs)(p,{className:"pt-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[(0,a.jsx)(B.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"font-medium",children:"获取指标数据失败"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:i}),(0,a.jsx)(u,{onClick:y,size:"sm",variant:"outline",className:"mt-3",children:"重试"})]})}),o&&!l&&!i&&(0,a.jsxs)("div",{className:"space-y-6",children:[T.length>0&&P.length>0&&(0,a.jsxs)(h,{children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(ef.A,{className:"h-5 w-5"}),"吞吐量指标"]}),(0,a.jsxs)(g,{children:["过去 ",x," 分钟的吞吐量数据趋势"]})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(en.u,{width:"100%",height:"100%",children:(0,a.jsxs)(el.b,{data:P,children:[(0,a.jsx)(ec.d,{strokeDasharray:"3 3"}),(0,a.jsx)(ei.W,{dataKey:"time",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(ed.h,{tick:{fontSize:12}}),(0,a.jsx)(eo.m,{}),(0,a.jsx)(em.s,{}),T.map((e,s)=>(0,a.jsx)(ex.N,{type:"monotone",dataKey:e.name,stroke:G[s%G.length],strokeWidth:2,dot:{r:3}},e.name))]})})})})]}),I.length>0&&P.length>0&&(0,a.jsxs)(h,{children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(ej.A,{className:"h-5 w-5"}),"延迟指标"]}),(0,a.jsxs)(g,{children:["过去 ",x," 分钟的延迟数据趋势（包括帧解码、推理和端到端延迟）"]})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(en.u,{width:"100%",height:"100%",children:(0,a.jsxs)(el.b,{data:P,children:[(0,a.jsx)(ec.d,{strokeDasharray:"3 3"}),(0,a.jsx)(ei.W,{dataKey:"time",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(ed.h,{tick:{fontSize:12}}),(0,a.jsx)(eo.m,{}),(0,a.jsx)(em.s,{}),I.map((e,s)=>(0,a.jsx)(ex.N,{type:"monotone",dataKey:e.name,stroke:G[s%G.length],strokeWidth:2,dot:{r:3}},e.name))]})})})})]}),_.length>0&&z.length>0&&(0,a.jsxs)(h,{children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(eg.A,{className:"h-5 w-5"}),"状态时间线"]}),(0,a.jsxs)(g,{children:["过去 ",x," 分钟的Pipeline组件状态变化"]})]}),(0,a.jsxs)(p,{children:[(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(en.u,{width:"100%",height:"100%",children:(0,a.jsxs)(el.b,{data:z,children:[(0,a.jsx)(ec.d,{strokeDasharray:"3 3"}),(0,a.jsx)(ei.W,{dataKey:"time",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(ed.h,{tick:{fontSize:12},domain:[0,8],tickFormatter:e=>{switch(e){case 0:return"NOT_STARTED";case 1:return"INITIALISING";case 2:return"RESTARTING";case 3:return"RUNNING";case 4:return"PAUSED";case 5:return"MUTED";case 6:return"TERMINATING";case 7:return"ENDED";case 8:return"ERROR";default:return""}}}),(0,a.jsx)(eo.m,{content:(0,a.jsx)(e=>{let{active:s,payload:t,label:r}=e;return s&&t&&t.length?(0,a.jsxs)("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[(0,a.jsx)("p",{className:"font-medium",children:"时间: ".concat(r)}),t.map((e,s)=>{let t="".concat(e.dataKey,"_label"),r=e.payload[t]||"unknown";return(0,a.jsx)("p",{style:{color:e.color},children:"".concat(e.dataKey.replace(" ("," ("),": ").concat(r)},s)})]}):null},{})}),(0,a.jsx)(em.s,{}),_.map((e,s)=>(0,a.jsx)(ex.N,{type:"stepAfter",dataKey:e.name,stroke:G[s%G.length],strokeWidth:3,dot:{r:4}},e.name))]})})}),(0,a.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,a.jsxs)(E,{variant:"outline",className:"bg-gray-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-500 mr-1"}),"NOT_STARTED"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-blue-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 mr-1"}),"INITIALISING"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-orange-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-orange-500 mr-1"}),"RESTARTING"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-green-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500 mr-1"}),"RUNNING"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-yellow-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-yellow-500 mr-1"}),"PAUSED"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-purple-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-purple-500 mr-1"}),"MUTED"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-pink-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-pink-500 mr-1"}),"TERMINATING"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-slate-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-slate-500 mr-1"}),"ENDED"]}),(0,a.jsxs)(E,{variant:"outline",className:"bg-red-100",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500 mr-1"}),"ERROR"]})]})]})]}),D.length>0&&P.length>0&&(0,a.jsxs)(h,{children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(U.A,{className:"h-5 w-5"}),"其他性能指标"]}),(0,a.jsxs)(g,{children:["过去 ",x," 分钟的其他性能数据趋势"]})]}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(en.u,{width:"100%",height:"100%",children:(0,a.jsxs)(el.b,{data:P,children:[(0,a.jsx)(ec.d,{strokeDasharray:"3 3"}),(0,a.jsx)(ei.W,{dataKey:"time",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(ed.h,{tick:{fontSize:12}}),(0,a.jsx)(eo.m,{}),(0,a.jsx)(em.s,{}),D.map((e,s)=>(0,a.jsx)(ex.N,{type:"monotone",dataKey:e.name,stroke:G[s%G.length],strokeWidth:2,dot:{r:3}},e.name))]})})})})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(f,{children:(0,a.jsx)(j,{children:"数据统计"})}),(0,a.jsx)(p,{children:(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:o.dates.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"数据点"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:T.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"吞吐量指标"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:I.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"延迟指标"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:_.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"状态指标"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-gray-600",children:[x,"min"]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"时间范围"})]})]})})]})]}),o&&!l&&!i&&0===P.length&&(0,a.jsx)(h,{children:(0,a.jsx)(p,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(eg.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"暂无指标数据"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"所选时间范围内没有找到指标数据"}),(0,a.jsx)(u,{onClick:y,size:"sm",children:"重新加载"})]})})})]})]})})}var eN=t(741),eb=t(1284);function ew(){let[e,s]=(0,r.useState)(null),[t,n]=(0,r.useState)(!1);return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:[(0,a.jsx)("header",{className:"bg-white/80 backdrop-blur-sm border-b border-white/20 sticky top-0 z-40",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)(J.A,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Coral Inference Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"实时推理管道监控与控制面板"})]})]}),e&&(0,a.jsxs)(u,{onClick:()=>n(!0),className:"bg-blue-600 hover:bg-blue-700 text-white shadow-lg",children:[(0,a.jsx)(eN.A,{className:"h-4 w-4 mr-2"}),"查看指标"]})]})})}),(0,a.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-4 space-y-6",children:[(0,a.jsx)(M,{selectedPipeline:e,onPipelineChange:s}),(0,a.jsxs)(h,{className:"bg-white/70 backdrop-blur-sm border-white/20",children:[(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{className:"flex items-center gap-2",children:[(0,a.jsx)(eb.A,{className:"h-5 w-5"}),"系统信息"]}),(0,a.jsx)(g,{children:"当前系统状态概览"})]}),(0,a.jsx)(p,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"系统状态"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-600",children:"正常运行"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"API服务"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-600",children:"已连接"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"WebRTC支持"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-600",children:"已启用"})]}),e&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"活动Pipeline"}),(0,a.jsx)("span",{className:"text-sm font-medium text-blue-600",children:e})]})]})})]}),(0,a.jsxs)(h,{className:"bg-white/70 backdrop-blur-sm border-white/20",children:[(0,a.jsxs)(f,{children:[(0,a.jsx)(j,{children:"快速操作"}),(0,a.jsx)(g,{children:"常用功能快捷入口"})]}),(0,a.jsx)(p,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(u,{variant:"outline",className:"w-full justify-start",onClick:()=>n(!0),disabled:!e,children:[(0,a.jsx)(eN.A,{className:"h-4 w-4 mr-2"}),"查看性能指标"]}),(0,a.jsxs)(u,{variant:"outline",className:"w-full justify-start",disabled:!e,children:[(0,a.jsx)(J.A,{className:"h-4 w-4 mr-2"}),"Pipeline设置"]})]})})]})]}),(0,a.jsx)("div",{className:"lg:col-span-8",children:(0,a.jsx)(H,{pipelineId:e})})]}),(0,a.jsxs)("div",{className:"mt-12 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Coral Inference Dashboard - 实时推理管道监控系统"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"支持WebRTC视频流、实时性能监控和Pipeline管理"})]})]}),(0,a.jsx)(ep,{isOpen:t,onClose:()=>n(!1),pipelineId:e})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[896,441,684,358],()=>s(2801)),_N_E=e.O()}]);